services:
    db:
        image: mysql:8.0
        container_name: sentinel-mysql
        environment:
            MYSQL_ROOT_PASSWORD: root
            MYSQL_DATABASE: serversentinel
        ports:
            - "3306:3306"
        volumes:
            - sentinel-db-data:/var/lib/mysql
        healthcheck:
            test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
            timeout: 20s
            retries: 10
    api:
        build:
            context: ./backend
            dockerfile: Dockerfile
        container_name: sentinel-api
        depends_on:
            db:
                condition: service_healthy
        ports:
            - "8000:8000"
        environment:
            # The DATABASE_URL for inside the docker network
            DATABASE_URL: "mysql+pymysql://root:root@db:3306/serversentinel"
        volumes:
            - ./backend/app:/app/app # Mount the app directory for live-reloading
        command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

volumes:
    sentinel-db-data:
